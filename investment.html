<!DOCTYPE HTML>
<!--
-->
<html>
	<head>
		<title>Xiao Tianyou Theo Portfolio</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo">Theo</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="index.html">Projects</a></li>
							<li><a href="handwriting_recognition.html">Handwriting</a></li>
							<li><a href="binary_search.html">Binary_Search</a></li>
							<li class = "active"><a href="investment.html">Investment</a></li>
							<li><a href="mnist.html">MNIST</a></li>
							<li><a href="passion_computing.html">Passion_Programming</a></li>
							<li><a href="myself.html">Myself</a></li>
						</ul>
						<ul class="icons">
							<li><a href="https://github.com/theo-xiao-sg" class="icon brands fa-github" target="_blank""><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
									<h1>Backtesting Moving Average trading strategy</h1>
									<a href="https://github.com/theo-xiao-sg/investment_python" target="_blank" class="button">Source code</a>

								</header>
								<!-- Lists -->
								<h3>Introduction</h3>
								<p>During every Chinese New Year, I receive some money from my parents, grandparents, and other relatives and friends. I have been investing this money in technology stocks such as Apple, Tesla, Amazon, Microsoft, Tencent, and others. My simple investment strategy is to buy the stocks of the companies which a lot of us use the products of. Following the technology boom in 2020, I made significant profits. However, I experienced a significant loss when the market underwent a drawdown towards the end of 2021.</p>
								<p>To mitigate such drawdowns and participate in market rallies, I turned to YouTube for guidance. There are numerous stock trading videos that teach strategies to avoid drawdowns and identify market rallies. One of the most popular tools recommended is the Simple Moving Average (SMA or MA) with a period of 200 days. Many content creators advertised SMA 200 as a miracle, able to participate in the market rallies while avoiding drawdowns. I was sceptical about that as it sounded too good to be true and I built a backtest model to test this popular strategy using Python.</p>
								<p>After carefully backtesting the SMA strategies, a clear disparity emerges. Investment videos, particularly those seeking to attract paying customers, often emphasize a wrongly backtested SMA strategy that showcases remarkably high returns. This can lead to unrealistic expectations. In contrast, the correctly backtested SMA profit, which is rarely disclosed, provides a more realistic perspective. </p>
								<p>I hope my careful research and backtest can help many investors become more careful while surrounded by much unsound paid investment advice. In addition, the backtest framework can be used for testing other trading strategies, or even apply AI models on it in the future. It again shows I become much more resourceful with the help of Python programming.</p>
								<h3>Data and Method</h3>
								<p>The Simple Moving Average (SMA or MA) trading strategy is a popular technical analysis approach used by traders to identify potential trend reversals or entry/exit points in financial markets. The strategy involves calculating the average price of an asset over a specified period and using it as a reference for making trading decisions.</p>
								<p>Here's how the Simple Moving Average trading strategy typically works:</p>
								<ol>
									<li>Select a time period: Determine the time period for calculating the moving average. Common choices include 50 days, 100 days, or 200 days. In this example, I choose 200 days.</li>
									<li>Calculate the moving average: Add up the daily prices of the stock over the selected time period and divide it by the number of days to get the average. This forms the moving average line.</li>
									<li>Monitor the price movement: Compare the current price of the stock with the moving average line. If the price crosses above the moving average line, it may indicate a positive signal, suggesting a potential uptrend. Conversely, if the price crosses below the moving average line, it may suggest a negative signal, indicating a potential downtrend.</li>
									<li>Make trading decisions: If the price crosses above the moving average line, you should buy the stock to participate in the market rally; if the price crosses below the moving average line, you should sell the stock to avoid drawdown.</li>
								</ol>
								<p>The yfinance (Yahoo Finance) package is a powerful tool in Python for downloading historical stock market data. It allows users to fetch data directly from Yahoo Finance. To illustrate, I show the prices of Tesla and Microsoft from 2020-01-01 to 2023-06-16.</p>
								<!-- Image -->

								<style>
									.image-caption {
									  text-align: center;
									  font-style: italic;
									  }
								  </style>

								  <div class="box alt">
									<div class="row gtr-50 gtr-uniform">
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Tesla, Inc._prices.png" alt="" />
										  </span>
										</figure>
									  </div>
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Microsoft Corporation_prices.png" alt="" />
										  </span>
										</figure>
									  </div>
									</div>
								  </div>
								<h3>Results</h3>
								<div class="image main"><img src="images/Tesla, Inc._200ma.png" style="width: 80%; height: auto;"></div>
								<p>In the plot displayed above, I have depicted the daily price movement of my favourite stock, Tesla, from January 2020 to Jun 2023. Additionally, the 200-day moving average line has been included in the graph. By observing the plot, it becomes evident that when the stock prices rise above the moving average line from beginning of 2020 to beginning of 2022 and just recently. It serves as a clear positive signal, and you can make quite some money if you hold this stock during this period. Conversely, when the price crosses below the moving average line from beginning of 2022 to recently, it signifies a negative signal, suggesting a potential drawdown, and you should sell this stock just when it happens. </p>
								<p>It sounds quite easy to be successful in investing in stock markets. And it is what most youtubers hope to achieve as shown in the following graph. The orange line represents the profits and losses of the SMA 200 strategy, while the blue line represents the profits and losses of the buy-and-hold strategy. The buy-and-hold strategy simply means I keep the stock throughout this period, and it serves as a benchmark to assess any dynamic trading strategy. As shown by the following plot, the moving average strategy makes significant profit than simply holding the stock. Thus, we always participate in the market rally and avoid market drawdown.  </p>
								<div class="image main"><img src="images/Tesla, Inc._200ma_pnl1.png" style="width: 80%; height: auto;"></div>
								<p>However, during my careful backtest, I found out this performance line is not realistic and wrongly backtested. Many people misaligned the prices and signals. They forgot the signals are only known after the prices are available for the day. So, they can only trade the signal the next day and it means we should have shifted the signal by one day. As the below graph shows, this small mistake has a huge impact on the backtested performance. Thus, I name the above graph as the fake SMA line as they are usually shown by many so-called investment experts in their YouTube videos.</p>
								<p>After conducting a careful backtest, the plot below illustrates the profit and loss (PnL) of the correctly backtested SMA 200 strategy. While the SMA still generated okay performance, it falls short of the performance of a simple buy-and-hold strategy. This indicates that the real SMA 200 strategy does not live up to the claims made by numerous investment gurus. We could have used the time and effort to do other useful things in life rather than trading in-out in the stock markets following this strategy.</p>
								<div class="image main"><img src="images/Tesla, Inc._200ma_pnl2.png" style="width: 80%; height: auto;"></div>
								<p>When examining the performance of the fake SMA, real SMA, and buy-and-hold strategies in a single plot, a distinct disparity becomes even more evident. The green line corresponds to the wrongly backtested SMA profit frequently emphasized in investment videos, particularly those aiming to entice viewers into paying for investment lessons. It portrays remarkably higher returns, potentially creating unrealistic expectations. In contrast, the orange line represents the correctly backtested SMA profit, a perspective seldom disclosed by individuals within the investment community.  The contrast between the two lines emphasizes the exaggerated claims made by some individuals in the investment community. It highlights the need for critical evaluation and scrutiny when encountering investment advice.</p>
								<div class="image main"><img src="images/Tesla, Inc._200ma_pnl3.png" style="width: 80%; height: auto;"></div>
								<p>After conducting tests on this moving average strategy with other technology stocks (Microsoft, Amazon, Apple, ...), it has become apparent that this approach does not always enhance performance compared to simply holding the stock throughout the given period. Certainly, the strategy's performance falls considerably short of the claims made by many investment gurus on YouTube.</p>
							<!-- Image -->

								<style>
									.image-caption {
									  text-align: center;
									  font-style: italic;
									  }
								  </style>

								  <div class="box alt">
									<div class="row gtr-50 gtr-uniform">
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Apple Inc._200ma.png" alt="" />
										  </span>
										</figure>
									  </div>
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Apple Inc._200ma_pnl3.png" alt="" />
										  </span>
										</figure>
									  </div>
									</div>
								  </div>
								<div class="box alt">
									<div class="row gtr-50 gtr-uniform">
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Amazon.com, Inc._200ma.png" alt="" />
										  </span>
										</figure>
									  </div>
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Amazon.com, Inc._200ma_pnl3.png" alt="" />
										  </span>
										</figure>
									  </div>
									</div>
								  </div>
								<div class="box alt">
									<div class="row gtr-50 gtr-uniform">
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Microsoft Corporation_200ma.png" alt="" />
										  </span>
										</figure>
									  </div>
									  <div class="col-6">
										<figure>
										  <span class="image fit">
											<img src="images/Microsoft Corporation_200ma_pnl3.png" alt="" />
										  </span>
										</figure>
									  </div>
									</div>
								  </div>
								<p>If this piques your interest, and you want to try it out with other stocks as well, you can always just use this code and replace the variable called “Ticker” with another stock. The code always update you with the up-to-date prices from Yahoo Finance. Also, if you are interested in the results for a different SMA window than 200 days, you can always just use this code and replace the variable called “ma_window” with another range.</p>
								<p>To this end, this backtest framework can be used for testing other trading strategies, or even training AI models on it in the future. It again shows we become much more resourceful to solve real life problem with the help of Python programming.</p>
								<p>Check my code in GitHub:</p>
								<a href="https://github.com/theo-xiao-sg/investment_python" target="_blank" class="button">Source code</a>
								<p>  </p>
								<p>Or you can find the main code here below:</p>

<!-- Preformatted Code -->
<link rel="stylesheet" href="styles.css">
<pre><code class="highlight"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># retrieve historical data from Yahoo Finance</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Define a start date and End Date to retrieve the historical data from Yahoo Finance</span>
<span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;2010-01-01&#39;</span>
<span class="c1">#setting today date as End Date</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Define the ticker symbol for the NASDAQ 100 index or the tech stocks</span>
<span class="c1"># ticker = &#39;^NDX&#39;</span>
<span class="c1"># ticker = &#39;TSLA&#39;</span>
<span class="c1"># ticker = &#39;MSFT&#39;</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;AAPL&#39;</span>
<span class="c1"># ticker = &#39;AMZN&#39;</span>
<span class="c1"># ticker = &#39;GOOG&#39;</span>
<span class="c1"># ticker = &#39;0700.HK&#39;</span>
<span class="c1"># ticker = &#39;NFLX&#39;</span>

<span class="c1"># Create a Ticker object for the desired ticker symbol</span>
<span class="n">ticker_y</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

<span class="c1"># Get the short name of the ticker</span>
<span class="n">company_name</span> <span class="o">=</span> <span class="n">ticker_y</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;shortName&quot;</span><span class="p">]</span>

<span class="c1"># Download historical data for the NASDAQ 100 index from Yahoo Finance</span>
<span class="n">download_data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># calculate moving average and daily returns</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">stock_data</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># rename column name to &#39;price&#39;</span>
<span class="n">stock_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Close&#39;</span><span class="p">:</span> <span class="s1">&#39;price&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Calculate the 200-day moving average</span>
<span class="n">ma_window</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;moving_average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">ma_window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Calculate the daily returns</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># calculate the trading signal</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Create a new column to store the trading signal</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Apply the trading signal logic based on 200d MA</span>
<span class="n">stock_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;moving_average&#39;</span><span class="p">],</span> <span class="s1">&#39;signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Calculate the daily returns based on the trading signal</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;signal_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;fake_signal_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">stock_data</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># slice the data to plot pnl from 2020-01-01 to today</span>
<span class="n">stock_data_slice</span> <span class="o">=</span> <span class="n">stock_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">:]</span>


<span class="c1"># Calculate the cumulative returns</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;cumulative_signal_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;signal_return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_cumulative_signal_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_signal_return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>

<span class="c1"># Calculate the PnL for the MA strategy, assuming we invest $100</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;MA_PnL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;cumulative_signal_return&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_MA_PnL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_cumulative_signal_return&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Calculate the PnL for Buy and Hold investment strategy, assuming we invest $100</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;cumulative_return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;daily_return&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;Buy_Hold_PnL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;cumulative_return&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># make plots</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">images_folder</span> <span class="o">=</span> <span class="s1">&#39;images&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">images_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot prices and the moving average</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;moving_average&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-day Moving Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">company_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Prices and &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-day Moving Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">ma.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">images_folder</span><span class="p">,</span> <span class="n">company_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Plot the cumulative PnL for both the Buy-Hold and MA strategy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;Buy_Hold_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buy_Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_MA_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fake_MA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">company_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Comparison of Buy_Hold vs MA Strategies - Cumulative PnL&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PnL ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">ma_pnl1.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">images_folder</span><span class="p">,</span> <span class="n">company_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Plot the cumulative PnL for both the Buy-Hold and MA strategy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;Buy_Hold_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buy_Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;MA_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">company_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Comparison of Buy_Hold vs MA Strategies - Cumulative PnL&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PnL ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">ma_pnl2.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">images_folder</span><span class="p">,</span> <span class="n">company_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Plot the cumulative PnL for both the Buy-Hold and MA strategy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;Buy_Hold_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buy_Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;MA_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stock_data_slice</span><span class="p">[</span><span class="s1">&#39;fake_MA_PnL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fake_MA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">company_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Comparison of Buy_Hold vs MA Strategies - Cumulative PnL&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PnL ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">ma_pnl3.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">images_folder</span><span class="p">,</span> <span class="n">company_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ma_window</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span></pre></div></code></pre>
							</section>
					</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>